#!/bin/bash

# This shell script combines the source files into the archive.

echo "Compile archive..."

# pre build cleanup
rm -rf var

# fill dev archive
mkdir -p var/stronghold_s5mp/archive.bba.unpacked
cp -r modfiles/graphics var/stronghold_s5mp/archive.bba.unpacked
cp -r modfiles/config var/stronghold_s5mp/archive.bba.unpacked
cp -r modfiles/script var/stronghold_s5mp/archive.bba.unpacked
cp -r modfiles/text var/stronghold_s5mp/archive.bba.unpacked
cp -r modfiles/menu var/stronghold_s5mp/archive.bba.unpacked

# fill archives
mkdir -p var/stronghold_s5mp/textureslow.bba.unpacked/graphics
mkdir -p var/stronghold_s5mp/texturesmed.bba.unpacked/graphics
mkdir -p var/stronghold_s5mp/textures.bba.unpacked/graphics
mkdir -p var/stronghold_s5mp/system.bba.unpacked/graphics
cp -r modfiles/graphics/animations var/stronghold_s5mp/system.bba.unpacked/graphics
cp -r modfiles/graphics/models var/stronghold_s5mp/system.bba.unpacked/graphics
cp -r modfiles/graphics/textureslow var/stronghold_s5mp/textureslow.bba.unpacked/graphics
cp -r modfiles/graphics/texturesmed var/stronghold_s5mp/texturesmed.bba.unpacked/graphics
cp -r modfiles/graphics/textures var/stronghold_s5mp/textures.bba.unpacked/graphics
cp -r modfiles/graphics/videos var/stronghold_s5mp/system.bba.unpacked/graphics
cp -r modfiles/config var/stronghold_s5mp/system.bba.unpacked
cp -r modfiles/script var/stronghold_s5mp/system.bba.unpacked
cp -r modfiles/text var/stronghold_s5mp/system.bba.unpacked
cp -r modfiles/menu var/stronghold_s5mp/system.bba.unpacked

# copy cerberus folder
mkdir -p var/stronghold_s5mp/system.bba.unpacked/script
cp -r "E:/Repositories/cerberus/var/cerberus" .
cp -r cerberus var/stronghold_s5mp/system.bba.unpacked/script

# pack archive
bin/bba5.exe var/stronghold_s5mp/archive.bba.unpacked
bin/bba5.exe var/stronghold_s5mp/textureslow.bba.unpacked
bin/bba5.exe var/stronghold_s5mp/texturesmed.bba.unpacked
bin/bba5.exe var/stronghold_s5mp/textures.bba.unpacked
bin/bba5.exe var/stronghold_s5mp/system.bba.unpacked

echo "Done!"

echo "Create release..."

# fill release folder
rm -rf release/stronghold_s5mp
rm -rf release/shs5mp_configs
rm -rf release/*.s5x
mkdir -p release/stronghold_s5mp
mkdir -p release/shs5mp_configs
cp -r var/stronghold_s5mp/* release/stronghold_s5mp

# copy maps
bin/bba5.exe "maps/StrongholdTutorial.s5x.unpacked"
cp "maps/StrongholdTutorial.s5x" release
cp "maps/StrongholdTutorial.lua" release/shs5mp_configs

bin/bba5.exe "maps/StrongholdSmallDale.s5x.unpacked"
cp "maps/StrongholdSmallDale.s5x" release
cp "maps/StrongholdSmallDale.lua" release/shs5mp_configs

bin/bba5.exe "maps/(4) SH Auge der Sahara.s5x.unpacked"
cp "maps/(4) SH Auge der Sahara.s5x" release
cp "maps/(4) SH Auge der Sahara.lua" release/shs5mp_configs

bin/bba5.exe "maps/(2) SH Schiffbruch.s5x.unpacked"
cp "maps/(2) SH Schiffbruch.s5x" release
cp "maps/(2) SH Schiffbruch.lua" release/shs5mp_configs

bin/bba5.exe "maps/(4) SH Kuestenjuwelen.s5x.unpacked"
cp "maps/(4) SH Kuestenjuwelen.s5x" release
cp "maps/(4) SH Kuestenjuwelen.lua" release/shs5mp_configs

echo "Done!"

echo "Clean up..."

# post build cleanup
rm -rf var/stronghold_s5mp/*.bba.unpacked
rm -rf release/stronghold_s5mp/*.bba.unpacked
rm -rf release/stronghold_s5mp/archive.bba

echo "Done!"

echo "Everything ready"